<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crear Compra</title>
</head>
<body>
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.as_p }}

    <h3>Productos de la compra</h3>
    <table id="productos-table">
      <thead>
        <tr>
          <th>Producto</th>
          <th>Cantidad</th>
          <th>Precio Unitario</th>
          <th>Subtotal</th>
          <th>Eliminar</th>
        </tr>
      </thead>
      <tbody id="productos-body">
      </tbody>
    </table>
    <button type="button" id="add-product">Agregar Producto</button>

    <p>Total Neto: $<span id="total-neto">0</span></p>
    <p>IVA (19%): $<span id="iva">0</span></p>
    <p>Total Compra: $<span id="total-compra">0</span></p>

    <input type="hidden" name="productos_data" id="productos_data">
    <button type="submit">Guardar Compra</button>
  </form>
  <a href="{% url 'listar_compras' %}">Ver todas las compras</a>
  
    <!-- Template para agregar filas de productos dinámicamente -->
  <template id="producto-row-template">
    <tr>
      <td>
        <select class="producto-select" required>
          {% for producto in productos %}
            <option value="{{ producto.id_producto }}">{{ producto.n_producto }}</option>
          {% endfor %}
        </select>
      </td>
      <td><input type="number" class="cantidad-input" min="1" value="1" required></td>
      <td><input type="number" class="precio-input" min="0" value="0" required></td>
      <td class="subtotal">0</td>
      <td><button type="button" class="btn-eliminar">❌</button></td>
    </tr>
  </template>
  <script src="/static/js/compras.js"></script>
</body>
</html>