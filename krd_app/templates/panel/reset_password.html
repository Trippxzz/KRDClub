{% extends "base.html" %}
{% block content %}
<div class="min-h-screen flex items-center justify-center py-12 px-4">
    <div class="max-w-md w-full">
        <!-- Logo y Título -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold tracking-[0.3em] text-black mb-2">KRD</h1>
            <p class="text-gray-600">Restablecer Contraseña</p>
        </div>

        <!-- Card -->
        <div class="bg-white rounded-xl shadow-lg p-8 border border-gray-100">
            <div class="mb-6">
                <h2 class="text-xl font-bold text-gray-900">Nueva Contraseña</h2>
                <p class="text-sm text-gray-500 mt-1">Ingresa tu nueva contraseña</p>
            </div>

            <!-- Mensajes -->
            {% if messages %}
            <div class="mb-6">
                {% for message in messages %}
                <div class="{% if message.tags == 'error' %}bg-red-50 border-red-200 text-red-700{% else %}bg-green-50 border-green-200 text-green-700{% endif %} border rounded-lg p-3 text-sm">
                    <i class="fas {% if message.tags == 'error' %}fa-exclamation-circle{% else %}fa-check-circle{% endif %} mr-2"></i>
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <form method="POST">
                {% csrf_token %}
                
                <!-- Nueva Contraseña -->
                <div class="mb-4">
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-2">
                        Nueva Contraseña
                    </label>
                    <div class="relative">
                        <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400">
                            <i class="fas fa-lock"></i>
                        </span>
                        <input type="password" 
                               name="password" 
                               id="password" 
                               placeholder="••••••••"
                               class="w-full pl-10 pr-12 py-3 border-2 border-gray-200 rounded-lg focus:border-black focus:outline-none transition"
                               required
                               minlength="6">
                        <button type="button" 
                                onclick="togglePassword('password', 'eye-icon-1')" 
                                class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600">
                            <i class="fas fa-eye" id="eye-icon-1"></i>
                        </button>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">Mínimo 6 caracteres</p>
                </div>

                <!-- Confirmar Contraseña -->
                <div class="mb-6">
                    <label for="password2" class="block text-sm font-medium text-gray-700 mb-2">
                        Confirmar Contraseña
                    </label>
                    <div class="relative">
                        <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400">
                            <i class="fas fa-lock"></i>
                        </span>
                        <input type="password" 
                               name="password2" 
                               id="password2" 
                               placeholder="••••••••"
                               class="w-full pl-10 pr-12 py-3 border-2 border-gray-200 rounded-lg focus:border-black focus:outline-none transition"
                               required
                               minlength="6">
                        <button type="button" 
                                onclick="togglePassword('password2', 'eye-icon-2')" 
                                class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600">
                            <i class="fas fa-eye" id="eye-icon-2"></i>
                        </button>
                    </div>
                </div>

                <!-- Mensaje de coincidencia -->
                <div id="match-status" class="hidden mb-4 p-3 rounded-lg text-sm"></div>

                <!-- Botón Submit -->
                <button type="submit" 
                        id="submit-btn"
                        class="w-full bg-black hover:bg-gray-800 text-white py-3 rounded-lg font-medium tracking-wider transition disabled:bg-gray-400 disabled:cursor-not-allowed">
                    <i class="fas fa-key mr-2"></i>
                    CAMBIAR CONTRASEÑA
                </button>
            </form>
        </div>

        <!-- Link volver -->
        <div class="text-center mt-6">
            <a href="{% url 'panel_login' %}" class="text-gray-500 hover:text-black text-sm transition">
                <i class="fas fa-arrow-left mr-2"></i>Volver al login
            </a>
        </div>
    </div>
</div>

<script>
function togglePassword(inputId, iconId) {
    const input = document.getElementById(inputId);
    const icon = document.getElementById(iconId);
    
    if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
    } else {
        input.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
    }
}

// Validar coincidencia de contraseñas
const password1 = document.getElementById('password');
const password2 = document.getElementById('password2');
const matchStatus = document.getElementById('match-status');
const submitBtn = document.getElementById('submit-btn');

function checkMatch() {
    const p1 = password1.value;
    const p2 = password2.value;
    
    if (p2.length === 0) {
        matchStatus.classList.add('hidden');
        submitBtn.disabled = false;
        return;
    }
    
    matchStatus.classList.remove('hidden');
    
    if (p1 === p2) {
        matchStatus.classList.remove('bg-red-50', 'text-red-700', 'border-red-200');
        matchStatus.classList.add('bg-green-50', 'text-green-700', 'border', 'border-green-200');
        matchStatus.innerHTML = '<i class="fas fa-check-circle mr-2"></i>Las contraseñas coinciden';
        submitBtn.disabled = false;
    } else {
        matchStatus.classList.remove('bg-green-50', 'text-green-700', 'border-green-200');
        matchStatus.classList.add('bg-red-50', 'text-red-700', 'border', 'border-red-200');
        matchStatus.innerHTML = '<i class="fas fa-times-circle mr-2"></i>Las contraseñas no coinciden';
        submitBtn.disabled = true;
    }
}

password1.addEventListener('input', checkMatch);
password2.addEventListener('input', checkMatch);
</script>
{% endblock %}
